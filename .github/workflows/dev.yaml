name: Dev Environment â€” Terraform

on:
  workflow_dispatch:
  pull_request:
    branches: [ main ]
  push:
    branches: [ main ]

jobs:
  terraform_plan:
    name: Plan (Dev)
    if: github.event_name == 'pull_request'
    uses: alberto7088/workflows/.github/workflows/terraform-deployment.yaml@main
    with:
      environment:        dev
      terraform-action:   plan
      terraform-directory: infra/terraform
      gcp-credentials: ${{ secrets.GCP_CREDENTIALS_DEV }}
      tf-state-bucket: ${{ secrets.TF_STATE_BUCKET_DEV }}
      gcp-project:     ${{ secrets.GCP_PROJECT_DEV }}

  terraform_apply:
    name: Apply (Dev)
    if: github.event_name == 'push'
    uses: alberto7088/workflows/.github/workflows/terraform-deployment.yaml@main
    with:
      environment:        dev
      terraform-action:   apply
      terraform-directory: infra/terraform
      gcp-credentials: ${{ secrets.GCP_CREDENTIALS_DEV }}
      tf-state-bucket: ${{ secrets.TF_STATE_BUCKET_DEV }}
      gcp-project: ${{ secrets.GCP_PROJECT_DEV }}
